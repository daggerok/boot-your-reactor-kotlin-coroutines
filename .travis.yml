notifications:
  email: false
git:
  quiet: true
  depth: false
language: java
jdk: openjdk11
node_js: lts/*
python: 3.7
matrix:
  include:
    - python: 3.7
services:
  - xvfb
  - docker
addons:
  apt:
    update: false
    packages:
      - jq
      - bash
      - curl
      - tree
      - docker-ce
      - libxml2-utils
      - libappindicator1
      - fonts-liberation
      - google-chrome-stable
      - python3-setuptools
      - python3-pip
install: true
before_install:
  - export CHROME_BIN=/usr/bin/google-chrome
  - export DISPLAY=:99.0
  #
  - |
    if [ ! -f ${HOME}/.local/daggerok/bash-functions/master/main.bash ] ; then
      mkdir -p ${HOME}/.local/daggerok/bash-functions/master ;
      curl -s https://raw.githubusercontent.com/daggerok/bash-functions/master/main.bash > ${HOME}/.local/daggerok/bash-functions/master/main.bash ;
    fi
    source ${HOME}/.local/daggerok/bash-functions/master/main.bash ;
  - stop_any 80 5432 8080 8081 8082 8083 8084 8085 8086 8087 8088
  #
  - export PATH=$HOME/.local/bin:$PATH
  - pip -V
  - docker-compose version
  - pip3 install --user --upgrade pip
  - pip install --user --upgrade httpie docker-compose
  - http --version --debug
  - pip -V
  #
  - stop_any 80 8080 5432
  - docker-compose version
env:
  global:
    - TERM=dumb
jobs:
  include:
    - stage: test
      name: gradle opernjdk11
      jdk: openjdk11
      script: ./gradlew
    - stage: test
      jdk: openjdk8
      name: gradle opernjdk8
      script: ./gradlew
    - stage: deploy
      name: VuePress documentation deployment
      node_js: lts/*
      script: skip
      before_deploy:
        - cd $TRAVIS_BUILD_DIR/docs && npm i
        - cd $TRAVIS_BUILD_DIR/docs && npm run gh-pages
      env:
        # travis encrypt GITHUB_TOKEN=ololo-trololo
        - secure: "eRxQg/ZB0uXd6Bqj6+wbMdbzRDbqXfAtu/2f0A/G74RydXNJz4H8YOtPw7xm/Pu4o1iaVaYj9Pse/vVVo7SVRUIkYui1beBKGGfyHSVidLZAwYeoR/bpuXzBbWq7gs/er/6p8MYgYchc9ForrTqWzDtEuqHRN0VlBbfWw87zlI4Bwicvr3Jg0fMuDRFTR5Fx3H8LNY5aNhxr4MIhzihtUk0a6oj6U7SxU/PwScEeBIkKPRMmmOuxAYI7Q/qGSApd2sMgDTZQcBZ+G0jQFP/YMz1CT0ucD/bwc6yp5DJ4i1N59l5+3ZjZsJKohNk65TfPsxxu+M3v4HEA3hqHJ81gk2cKC+wPFUqPTA0zLqQ0GqDT9dcEr7PUzRu5lx73R0ObcT/AsHxkeJti3ed6xTgnpjyRP+acaMIgbTGbuRR+bn5ymQJzJ7Vkh/Uwrr/46Xoc/e+KJeJydXEqovjXZ1+I4wesaDOAJndBYT7pzD2/kuXGchd8RXvCuOq3arqGotxskRLo8+GwxjJBzsbZj9eXjZN33cYeOeGEO0qtFeedB7ef5Xz0w7WL7pG0przuOBhT6ikMdFS/N3jt6m/Uuojv/8kL2TGB/a4nv9jUQjnhePUNNa5FzSnh5e7GCKJWQh0Nf0bwZ7HL5OexPL/R5rmcqy7mk2FJPzqxTZ0UJIpoEJg="
      deploy: &pages
        provider: pages
        github-token: "$GITHUB_TOKEN"
        local-dir: docs/.vuepress/dist
        # require gh-pages to be created manually first before deployment!
        target_branch: gh-pages
        skip_cleanup: true
        keep-history: true
        on:
          branch: master
          condition: "$TRAVIS_PULL_REQUEST = false"
cache:
  directories:
    - ./docs/node_modules
    - ~/.local/daggerok
    - ~/.docker
    - ~/.n*
  packages: true
  npm: true
